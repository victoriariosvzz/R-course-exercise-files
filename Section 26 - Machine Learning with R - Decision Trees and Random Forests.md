---
title: "Section 26 - Machine Learning with R - Decision Trees and Random Forests"
author: "Victoria"
date: "13/1/2021"
output: html_document
---



#**Decision Trees and Random Forest with R**
Decision tree to make assumptions based on the factors selected, resulting in branches that give different results. The order of the selection matters.
_ Weakness: they don't have a very high accuracy  

##**Random Forest**
We create many trees with a random sample of features chosen as the split for each tree. This improves the accuracy of the model.
- m = sqrt(p: the whole set of features)

##**What's the point of using random forest?**
If there's a feature that's VERY STRONG in comparison to the others, decision trees selects it as the TOP SPLIT, in result you'll get similar trees that are highly correlated (bad). Random forests decorrelates the trees and make them independent from each other (good). 

# TREE MODEL

1. Check for labels as a factor, and values as int

```r
library(rpart)

str(kyphosis) #a condition of the spine, age in months, number of vertebrae involved
```

```
## 'data.frame':	81 obs. of  4 variables:
##  $ Kyphosis: Factor w/ 2 levels "absent","present": 1 1 2 1 1 1 1 1 1 2 ...
##  $ Age     : int  71 158 128 2 1 1 61 37 113 59 ...
##  $ Number  : int  3 3 4 5 4 2 2 3 2 6 ...
##  $ Start   : int  5 14 5 1 15 16 17 16 16 12 ...
```

```r
head(kyphosis)
```

```
##   Kyphosis Age Number Start
## 1   absent  71      3     5
## 2   absent 158      3    14
## 3  present 128      4     5
## 4   absent   2      5     1
## 5   absent   1      4    15
## 6   absent   1      2    16
```

2. Let's create the Tree Model

```r
tree <- rpart(Kyphosis ~ ., method = "class", data = kyphosis) #check that both kyphosis's are different things, the first one is the column name

printcp(tree)
```

```
## 
## Classification tree:
## rpart(formula = Kyphosis ~ ., data = kyphosis, method = "class")
## 
## Variables actually used in tree construction:
## [1] Age   Start
## 
## Root node error: 17/81 = 0.20988
## 
## n= 81 
## 
##         CP nsplit rel error  xerror
## 1 0.176471      0   1.00000 1.00000
## 2 0.019608      1   0.82353 0.94118
## 3 0.010000      4   0.76471 1.00000
##      xstd
## 1 0.21559
## 2 0.21078
## 3 0.21559
```

3. Let's plot the Tree

```r
#Manually
plot(tree, uniform = TRUE, main = "Kyphosis Tree")
text(tree, use.n = TRUE, all = TRUE)
```

![plot of chunk unnamed-chunk-11](figure/unnamed-chunk-11-1.png)

```r
#With the library rpart.plot (BETTER AND EASIER)
library(rpart.plot)
prp(tree)
```

![plot of chunk unnamed-chunk-11](figure/unnamed-chunk-11-2.png)

# RANDOM FORESTS

```r
library("randomForest")

rf.model <- randomForest(Kyphosis ~ ., data = kyphosis)

print(rf.model)
```

```
## 
## Call:
##  randomForest(formula = Kyphosis ~ ., data = kyphosis) 
##                Type of random forest: classification
##                      Number of trees: 500
## No. of variables tried at each split: 1
## 
##         OOB estimate of  error rate: 20.99%
## Confusion matrix:
##         absent present class.error
## absent      60       4   0.0625000
## present     13       4   0.7647059
```

```r
#The results are automatically arranged in columns
head(rf.model$predicted)
```

```
##      1      2      3      4      5 
## absent absent absent absent absent 
##      6 
## absent 
## Levels: absent present
```

```r
rf.model$ntree
```

```
## [1] 500
```

```r
#You can also get the confusion matrix and the error rate from here
rf.model$confusion
```

```
##         absent present class.error
## absent      60       4   0.0625000
## present     13       4   0.7647059
```

```r
rf.model$err.rate
```

```
##              OOB    absent   present
##   [1,] 0.2580645 0.2692308 0.2000000
##   [2,] 0.2173913 0.1621622 0.4444444
##   [3,] 0.2372881 0.1555556 0.5000000
##   [4,] 0.2121212 0.1176471 0.5333333
##   [5,] 0.2297297 0.1551724 0.5000000
##   [6,] 0.2207792 0.1475410 0.5000000
##   [7,] 0.2375000 0.1406250 0.6250000
##   [8,] 0.2098765 0.1093750 0.5882353
##   [9,] 0.2222222 0.1250000 0.5882353
##  [10,] 0.1851852 0.0937500 0.5294118
##  [11,] 0.2098765 0.1250000 0.5294118
##  [12,] 0.1975309 0.0937500 0.5882353
##  [13,] 0.2098765 0.1093750 0.5882353
##  [14,] 0.1728395 0.0625000 0.5882353
##  [15,] 0.1851852 0.0781250 0.5882353
##  [16,] 0.1604938 0.0625000 0.5294118
##  [17,] 0.1975309 0.0937500 0.5882353
##  [18,] 0.1851852 0.0937500 0.5294118
##  [19,] 0.1851852 0.0937500 0.5294118
##  [20,] 0.2098765 0.0937500 0.6470588
##  [21,] 0.1975309 0.0781250 0.6470588
##  [22,] 0.2098765 0.0937500 0.6470588
##  [23,] 0.1975309 0.0781250 0.6470588
##  [24,] 0.1975309 0.0781250 0.6470588
##  [25,] 0.1851852 0.0781250 0.5882353
##  [26,] 0.2098765 0.0937500 0.6470588
##  [27,] 0.2098765 0.0937500 0.6470588
##  [28,] 0.1975309 0.1093750 0.5294118
##  [29,] 0.1975309 0.1093750 0.5294118
##  [30,] 0.1851852 0.0937500 0.5294118
##  [31,] 0.1851852 0.0937500 0.5294118
##  [32,] 0.1728395 0.0781250 0.5294118
##  [33,] 0.1728395 0.0781250 0.5294118
##  [34,] 0.1851852 0.0937500 0.5294118
##  [35,] 0.1728395 0.0781250 0.5294118
##  [36,] 0.1728395 0.0781250 0.5294118
##  [37,] 0.1728395 0.0781250 0.5294118
##  [38,] 0.1728395 0.0781250 0.5294118
##  [39,] 0.1851852 0.0937500 0.5294118
##  [40,] 0.1728395 0.0781250 0.5294118
##  [41,] 0.1728395 0.0781250 0.5294118
##  [42,] 0.1604938 0.0625000 0.5294118
##  [43,] 0.1604938 0.0625000 0.5294118
##  [44,] 0.1851852 0.0937500 0.5294118
##  [45,] 0.1851852 0.0781250 0.5882353
##  [46,] 0.1481481 0.0312500 0.5882353
##  [47,] 0.1604938 0.0468750 0.5882353
##  [48,] 0.1728395 0.0625000 0.5882353
##  [49,] 0.1975309 0.0781250 0.6470588
##  [50,] 0.1851852 0.0625000 0.6470588
##  [51,] 0.1851852 0.0781250 0.5882353
##  [52,] 0.1975309 0.0781250 0.6470588
##  [53,] 0.2098765 0.0937500 0.6470588
##  [54,] 0.2098765 0.0937500 0.6470588
##  [55,] 0.1975309 0.0781250 0.6470588
##  [56,] 0.1851852 0.0625000 0.6470588
##  [57,] 0.1975309 0.0781250 0.6470588
##  [58,] 0.1975309 0.0781250 0.6470588
##  [59,] 0.1975309 0.0781250 0.6470588
##  [60,] 0.1975309 0.0781250 0.6470588
##  [61,] 0.2098765 0.0937500 0.6470588
##  [62,] 0.1975309 0.0781250 0.6470588
##  [63,] 0.2222222 0.1093750 0.6470588
##  [64,] 0.2222222 0.1093750 0.6470588
##  [65,] 0.2098765 0.0937500 0.6470588
##  [66,] 0.2098765 0.0937500 0.6470588
##  [67,] 0.2098765 0.0937500 0.6470588
##  [68,] 0.2098765 0.0937500 0.6470588
##  [69,] 0.1975309 0.0937500 0.5882353
##  [70,] 0.1975309 0.0937500 0.5882353
##  [71,] 0.2098765 0.0937500 0.6470588
##  [72,] 0.1975309 0.0937500 0.5882353
##  [73,] 0.2098765 0.0937500 0.6470588
##  [74,] 0.1975309 0.0937500 0.5882353
##  [75,] 0.1975309 0.0937500 0.5882353
##  [76,] 0.1975309 0.0937500 0.5882353
##  [77,] 0.1975309 0.0937500 0.5882353
##  [78,] 0.2098765 0.1093750 0.5882353
##  [79,] 0.1851852 0.0781250 0.5882353
##  [80,] 0.1975309 0.0937500 0.5882353
##  [81,] 0.2222222 0.0937500 0.7058824
##  [82,] 0.1975309 0.0937500 0.5882353
##  [83,] 0.1975309 0.0781250 0.6470588
##  [84,] 0.2222222 0.0937500 0.7058824
##  [85,] 0.1975309 0.0781250 0.6470588
##  [86,] 0.2098765 0.0781250 0.7058824
##  [87,] 0.2222222 0.0937500 0.7058824
##  [88,] 0.2098765 0.0781250 0.7058824
##  [89,] 0.2098765 0.0781250 0.7058824
##  [90,] 0.2098765 0.0781250 0.7058824
##  [91,] 0.2098765 0.0781250 0.7058824
##  [92,] 0.2098765 0.0781250 0.7058824
##  [93,] 0.2098765 0.0781250 0.7058824
##  [94,] 0.2098765 0.0781250 0.7058824
##  [95,] 0.2098765 0.0781250 0.7058824
##  [96,] 0.2222222 0.0937500 0.7058824
##  [97,] 0.2222222 0.0937500 0.7058824
##  [98,] 0.2098765 0.0781250 0.7058824
##  [99,] 0.2098765 0.0781250 0.7058824
## [100,] 0.2098765 0.0781250 0.7058824
## [101,] 0.2222222 0.0937500 0.7058824
## [102,] 0.2469136 0.1093750 0.7647059
## [103,] 0.2345679 0.0937500 0.7647059
## [104,] 0.2345679 0.0937500 0.7647059
## [105,] 0.2345679 0.0937500 0.7647059
## [106,] 0.2345679 0.0937500 0.7647059
## [107,] 0.2469136 0.1093750 0.7647059
## [108,] 0.2469136 0.1093750 0.7647059
## [109,] 0.2469136 0.1093750 0.7647059
## [110,] 0.2345679 0.0937500 0.7647059
## [111,] 0.2469136 0.1093750 0.7647059
## [112,] 0.2469136 0.1093750 0.7647059
## [113,] 0.2469136 0.1093750 0.7647059
## [114,] 0.2222222 0.0781250 0.7647059
## [115,] 0.2222222 0.0781250 0.7647059
## [116,] 0.2222222 0.0781250 0.7647059
## [117,] 0.2222222 0.0781250 0.7647059
## [118,] 0.2345679 0.0937500 0.7647059
## [119,] 0.2222222 0.0781250 0.7647059
## [120,] 0.2222222 0.0781250 0.7647059
## [121,] 0.2222222 0.0781250 0.7647059
## [122,] 0.2222222 0.0781250 0.7647059
## [123,] 0.2222222 0.0937500 0.7058824
## [124,] 0.2222222 0.0937500 0.7058824
## [125,] 0.2222222 0.0781250 0.7647059
## [126,] 0.2345679 0.0937500 0.7647059
## [127,] 0.2345679 0.0937500 0.7647059
## [128,] 0.2345679 0.0937500 0.7647059
## [129,] 0.2345679 0.0937500 0.7647059
## [130,] 0.2345679 0.0937500 0.7647059
## [131,] 0.2345679 0.0937500 0.7647059
## [132,] 0.2222222 0.0937500 0.7058824
## [133,] 0.2345679 0.0937500 0.7647059
## [134,] 0.2222222 0.0937500 0.7058824
## [135,] 0.2222222 0.0937500 0.7058824
## [136,] 0.2222222 0.0937500 0.7058824
## [137,] 0.2345679 0.0937500 0.7647059
## [138,] 0.2345679 0.0937500 0.7647059
## [139,] 0.2345679 0.0937500 0.7647059
## [140,] 0.2222222 0.0937500 0.7058824
## [141,] 0.2345679 0.0937500 0.7647059
## [142,] 0.2345679 0.0937500 0.7647059
## [143,] 0.2345679 0.0937500 0.7647059
## [144,] 0.2222222 0.0937500 0.7058824
## [145,] 0.2345679 0.0937500 0.7647059
## [146,] 0.2222222 0.0937500 0.7058824
## [147,] 0.2345679 0.1093750 0.7058824
## [148,] 0.2469136 0.1093750 0.7647059
## [149,] 0.2345679 0.1093750 0.7058824
## [150,] 0.2345679 0.1093750 0.7058824
## [151,] 0.2222222 0.0937500 0.7058824
## [152,] 0.2345679 0.1093750 0.7058824
## [153,] 0.2345679 0.1093750 0.7058824
## [154,] 0.2345679 0.1093750 0.7058824
## [155,] 0.2222222 0.0937500 0.7058824
## [156,] 0.2222222 0.0937500 0.7058824
## [157,] 0.2222222 0.0937500 0.7058824
## [158,] 0.2222222 0.0937500 0.7058824
## [159,] 0.2345679 0.1093750 0.7058824
## [160,] 0.2345679 0.1093750 0.7058824
## [161,] 0.2345679 0.1093750 0.7058824
## [162,] 0.2345679 0.1093750 0.7058824
## [163,] 0.2469136 0.1093750 0.7647059
## [164,] 0.2345679 0.0937500 0.7647059
## [165,] 0.2469136 0.1093750 0.7647059
## [166,] 0.2345679 0.0937500 0.7647059
## [167,] 0.2345679 0.0937500 0.7647059
## [168,] 0.2345679 0.0937500 0.7647059
## [169,] 0.2345679 0.0937500 0.7647059
## [170,] 0.2345679 0.0937500 0.7647059
## [171,] 0.2345679 0.0937500 0.7647059
## [172,] 0.2345679 0.0937500 0.7647059
## [173,] 0.2345679 0.0937500 0.7647059
## [174,] 0.2345679 0.0937500 0.7647059
## [175,] 0.2345679 0.0937500 0.7647059
## [176,] 0.2345679 0.0937500 0.7647059
## [177,] 0.2345679 0.0937500 0.7647059
## [178,] 0.2345679 0.0937500 0.7647059
## [179,] 0.2345679 0.0937500 0.7647059
## [180,] 0.2345679 0.0937500 0.7647059
## [181,] 0.2345679 0.0937500 0.7647059
## [182,] 0.2345679 0.0937500 0.7647059
## [183,] 0.2345679 0.0937500 0.7647059
## [184,] 0.2345679 0.0937500 0.7647059
## [185,] 0.2345679 0.0937500 0.7647059
## [186,] 0.2345679 0.0937500 0.7647059
## [187,] 0.2345679 0.0937500 0.7647059
## [188,] 0.2345679 0.0937500 0.7647059
## [189,] 0.2345679 0.0937500 0.7647059
## [190,] 0.2345679 0.0937500 0.7647059
## [191,] 0.2345679 0.0937500 0.7647059
## [192,] 0.2345679 0.0937500 0.7647059
## [193,] 0.2345679 0.0937500 0.7647059
## [194,] 0.2345679 0.0937500 0.7647059
## [195,] 0.2345679 0.0937500 0.7647059
## [196,] 0.2345679 0.0937500 0.7647059
## [197,] 0.2345679 0.0937500 0.7647059
## [198,] 0.2345679 0.0937500 0.7647059
## [199,] 0.2345679 0.0937500 0.7647059
## [200,] 0.2345679 0.0937500 0.7647059
## [201,] 0.2345679 0.0937500 0.7647059
## [202,] 0.2345679 0.0937500 0.7647059
## [203,] 0.2345679 0.0937500 0.7647059
## [204,] 0.2345679 0.0937500 0.7647059
## [205,] 0.2345679 0.0937500 0.7647059
## [206,] 0.2345679 0.0937500 0.7647059
## [207,] 0.2345679 0.0937500 0.7647059
## [208,] 0.2345679 0.0937500 0.7647059
## [209,] 0.2345679 0.0937500 0.7647059
## [210,] 0.2345679 0.0937500 0.7647059
## [211,] 0.2345679 0.0937500 0.7647059
## [212,] 0.2098765 0.0781250 0.7058824
## [213,] 0.2222222 0.0781250 0.7647059
## [214,] 0.2222222 0.0781250 0.7647059
## [215,] 0.2222222 0.0781250 0.7647059
## [216,] 0.2222222 0.0781250 0.7647059
## [217,] 0.2222222 0.0781250 0.7647059
## [218,] 0.2222222 0.0781250 0.7647059
## [219,] 0.2222222 0.0781250 0.7647059
## [220,] 0.2222222 0.0781250 0.7647059
## [221,] 0.2222222 0.0937500 0.7058824
## [222,] 0.2222222 0.0781250 0.7647059
## [223,] 0.2345679 0.0937500 0.7647059
## [224,] 0.2222222 0.0781250 0.7647059
## [225,] 0.2469136 0.1093750 0.7647059
## [226,] 0.2345679 0.0937500 0.7647059
## [227,] 0.2222222 0.0781250 0.7647059
## [228,] 0.2345679 0.0937500 0.7647059
## [229,] 0.2345679 0.0937500 0.7647059
## [230,] 0.2345679 0.0937500 0.7647059
## [231,] 0.2222222 0.0781250 0.7647059
## [232,] 0.2222222 0.0781250 0.7647059
## [233,] 0.2222222 0.0781250 0.7647059
## [234,] 0.2222222 0.0781250 0.7647059
## [235,] 0.2222222 0.0781250 0.7647059
## [236,] 0.2222222 0.0781250 0.7647059
## [237,] 0.2345679 0.0937500 0.7647059
## [238,] 0.2098765 0.0781250 0.7058824
## [239,] 0.2098765 0.0781250 0.7058824
## [240,] 0.2098765 0.0781250 0.7058824
## [241,] 0.2098765 0.0781250 0.7058824
## [242,] 0.2098765 0.0781250 0.7058824
## [243,] 0.2098765 0.0781250 0.7058824
## [244,] 0.2098765 0.0781250 0.7058824
## [245,] 0.2098765 0.0781250 0.7058824
## [246,] 0.2098765 0.0781250 0.7058824
## [247,] 0.2098765 0.0781250 0.7058824
## [248,] 0.2098765 0.0781250 0.7058824
## [249,] 0.2098765 0.0781250 0.7058824
## [250,] 0.2098765 0.0781250 0.7058824
## [251,] 0.2098765 0.0781250 0.7058824
## [252,] 0.2098765 0.0781250 0.7058824
## [253,] 0.2098765 0.0781250 0.7058824
## [254,] 0.2098765 0.0781250 0.7058824
## [255,] 0.2098765 0.0781250 0.7058824
## [256,] 0.2098765 0.0781250 0.7058824
## [257,] 0.2098765 0.0781250 0.7058824
## [258,] 0.2098765 0.0781250 0.7058824
## [259,] 0.2098765 0.0781250 0.7058824
## [260,] 0.2098765 0.0781250 0.7058824
## [261,] 0.2098765 0.0781250 0.7058824
## [262,] 0.2098765 0.0781250 0.7058824
## [263,] 0.2222222 0.0937500 0.7058824
## [264,] 0.2222222 0.0937500 0.7058824
## [265,] 0.2222222 0.0937500 0.7058824
## [266,] 0.2222222 0.0937500 0.7058824
## [267,] 0.2222222 0.0937500 0.7058824
## [268,] 0.2222222 0.0937500 0.7058824
## [269,] 0.2098765 0.0781250 0.7058824
## [270,] 0.2098765 0.0781250 0.7058824
## [271,] 0.2098765 0.0781250 0.7058824
## [272,] 0.2098765 0.0781250 0.7058824
## [273,] 0.2098765 0.0781250 0.7058824
## [274,] 0.2098765 0.0781250 0.7058824
## [275,] 0.2098765 0.0781250 0.7058824
## [276,] 0.2098765 0.0781250 0.7058824
## [277,] 0.2098765 0.0781250 0.7058824
## [278,] 0.2098765 0.0781250 0.7058824
## [279,] 0.2098765 0.0781250 0.7058824
## [280,] 0.2098765 0.0781250 0.7058824
## [281,] 0.2098765 0.0781250 0.7058824
## [282,] 0.2098765 0.0781250 0.7058824
## [283,] 0.2098765 0.0781250 0.7058824
## [284,] 0.2098765 0.0781250 0.7058824
## [285,] 0.2098765 0.0781250 0.7058824
## [286,] 0.2098765 0.0781250 0.7058824
## [287,] 0.2098765 0.0781250 0.7058824
## [288,] 0.2098765 0.0781250 0.7058824
## [289,] 0.2222222 0.0937500 0.7058824
## [290,] 0.2222222 0.0937500 0.7058824
## [291,] 0.2222222 0.0937500 0.7058824
## [292,] 0.2222222 0.0937500 0.7058824
## [293,] 0.2345679 0.0937500 0.7647059
## [294,] 0.2222222 0.0937500 0.7058824
## [295,] 0.2222222 0.0937500 0.7058824
## [296,] 0.2222222 0.0937500 0.7058824
## [297,] 0.2222222 0.0937500 0.7058824
## [298,] 0.2222222 0.0937500 0.7058824
## [299,] 0.2222222 0.0937500 0.7058824
## [300,] 0.2222222 0.0937500 0.7058824
## [301,] 0.2222222 0.0937500 0.7058824
## [302,] 0.2222222 0.0937500 0.7058824
## [303,] 0.2222222 0.0937500 0.7058824
## [304,] 0.2222222 0.0937500 0.7058824
## [305,] 0.2222222 0.0937500 0.7058824
## [306,] 0.2222222 0.0937500 0.7058824
## [307,] 0.2222222 0.0937500 0.7058824
## [308,] 0.2222222 0.0937500 0.7058824
## [309,] 0.2222222 0.0937500 0.7058824
## [310,] 0.2222222 0.0937500 0.7058824
## [311,] 0.2222222 0.0937500 0.7058824
## [312,] 0.2222222 0.0937500 0.7058824
## [313,] 0.2222222 0.0937500 0.7058824
## [314,] 0.2222222 0.0937500 0.7058824
## [315,] 0.2222222 0.0937500 0.7058824
## [316,] 0.2222222 0.0937500 0.7058824
## [317,] 0.2222222 0.0937500 0.7058824
## [318,] 0.2222222 0.0937500 0.7058824
## [319,] 0.2222222 0.0937500 0.7058824
## [320,] 0.2222222 0.0937500 0.7058824
## [321,] 0.2222222 0.0937500 0.7058824
## [322,] 0.2222222 0.0937500 0.7058824
## [323,] 0.2222222 0.0937500 0.7058824
## [324,] 0.2222222 0.0937500 0.7058824
## [325,] 0.2222222 0.0937500 0.7058824
## [326,] 0.2222222 0.0937500 0.7058824
## [327,] 0.2222222 0.0937500 0.7058824
## [328,] 0.2222222 0.0937500 0.7058824
## [329,] 0.2222222 0.0937500 0.7058824
## [330,] 0.2222222 0.0937500 0.7058824
## [331,] 0.2222222 0.0937500 0.7058824
## [332,] 0.2222222 0.0937500 0.7058824
## [333,] 0.2222222 0.0937500 0.7058824
##  [ reached getOption("max.print") -- omitted 167 rows ]
```

